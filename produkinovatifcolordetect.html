<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>ColorDetect - Deteksi Warna Dasar + Simulasi Buta Warna</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      background: #f8fbff;
      padding: 20px;
      color: #222;
    }
    video, canvas {
      display: block;
      margin: 15px auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    #colorBox {
      width: 120px;
      height: 120px;
      margin: 10px auto;
      border-radius: 8px;
      border: 2px solid #000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .label {
      margin-top: 20px;
      font-size: 1.3em;
      font-weight: bold;
    }
    button, select {
      margin: 10px 5px;
      padding: 12px 16px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    select {
      background-color: #6c757d;
    }
    #colorName {
      font-weight: bold;
      font-size: 1.1em;
      margin-top: 8px;
    }
    #speakBtn {
      background-color: #28a745;
    }
    #speakBtn:hover {
      background-color: #1e7e34;
    }
  </style>
</head>
<body>

  <h2>ColorDetect - Deteksi Warna Dasar + Simulasi Buta Warna</h2>
  <video id="video" width="320" height="240" autoplay></video>
  <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
  <canvas id="simCanvas" width="320" height="240"></canvas>

  <label for="filterSelect"><strong>Simulasi Penglihatan:</strong></label>
  <select id="filterSelect">
    <option value="normal">Normal</option>
    <option value="protanopia">Protanopia</option>
    <option value="deuteranopia">Deuteranopia</option>
    <option value="tritanopia">Tritanopia</option>
  </select>

  <div class="label">Warna Asli yang Terdeteksi</div>
  <div id="colorBox"></div>
  <p id="colorInfo">Mengambil data warna dari kamera...</p>
  <p id="colorName">Nama Warna: -</p>
  <button id="speakBtn" onclick="speakColor()">ðŸ”Š Baca Warna</button>

  <script>
    function rgbToHex(r, g, b) {
      return "#" + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase();
    }

    function getBasicColorName(r, g, b) {
      const thresholds = {
        hitam: r < 40 && g < 40 && b < 40,
        putih: r > 220 && g > 220 && b > 220,
        abu: Math.abs(r - g) < 15 && Math.abs(r - b) < 15 && Math.abs(g - b) < 15 && r > 60 && r < 200,
        merah: r > 150 && g < 100 && b < 100,
        hijau: g > 150 && r < 100 && b < 100,
        biru: b > 150 && r < 100 && g < 100,
        kuning: r > 180 && g > 180 && b < 100,
        jingga: r > 200 && g > 120 && g < 170 && b < 100,
        ungu: r > 100 && b > 100 && g < 80,
        coklat: r > 100 && g > 50 && g < 100 && b < 80,
        pink: r > 200 && g < 150 && b > 150
      };

      for (let [warna, kondisi] of Object.entries(thresholds)) {
        if (kondisi) return warna.charAt(0).toUpperCase() + warna.slice(1);
      }
      return "Tidak diketahui";
    }

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const simCanvas = document.getElementById("simCanvas");
    const ctx = canvas.getContext("2d");
    const simCtx = simCanvas.getContext("2d");
    const colorBox = document.getElementById("colorBox");
    const colorInfo = document.getElementById("colorInfo");
    const colorNameDisplay = document.getElementById("colorName");
    const filterSelect = document.getElementById("filterSelect");
    let currentColor = "-";

    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      video.srcObject = stream;
    });

    function applyFilter(r, g, b, type) {
      if (type === "protanopia") {
        return [0.56667 * r + 0.43333 * g, 0.55833 * r + 0.44167 * g, b];
      } else if (type === "deuteranopia") {
        return [r, 0.7 * g + 0.3 * b, 0.3 * g + 0.7 * b];
      } else if (type === "tritanopia") {
        return [r, g, 0.95 * g + 0.05 * b];
      }
      return [r, g, b];
    }

    setInterval(() => {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const pixel = ctx.getImageData(centerX, centerY, 1, 1).data;
      const [r, g, b] = pixel;
      const hex = rgbToHex(r, g, b);
      colorBox.style.backgroundColor = hex;
      colorInfo.textContent = `RGB: (${r}, ${g}, ${b}) | Hex: ${hex}`;
      const name = getBasicColorName(r, g, b);
      currentColor = name;
      colorNameDisplay.textContent = `Nama Warna: ${name}`;

      // Simulasi buta warna
      const pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = pixels.data;
      const filterType = filterSelect.value;
      for (let i = 0; i < data.length; i += 4) {
        const [fr, fg, fb] = applyFilter(data[i], data[i+1], data[i+2], filterType);
        data[i] = fr;
        data[i+1] = fg;
        data[i+2] = fb;
      }
      simCtx.putImageData(pixels, 0, 0);
    }, 250);

    function speakColor() {
      const msg = new SpeechSynthesisUtterance(`Warna ini adalah ${currentColor}`);
      msg.lang = 'id-ID';
      speechSynthesis.speak(msg);
    }
  </script>
</body>
</html>
